\documentclass[12pt, a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage[T2A]{fontenc}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{indentfirst}
\usepackage{amsthm}
\DeclareMathOperator*{\minn}{min}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{state}{Утверждение}[section]
\newtheorem{lemma}{Лемма}[section]
\newtheorem{corollary}{Следствие}[section]


\usepackage[left=2cm,right=1.5cm,top=2cm,bottom=2cm]{geometry}
\linespread{1.25}

\usepackage{graphicx}
\graphicspath{{pictures/}}
\DeclareGraphicsExtensions{.pdf,.png,.jpg}

\begin{document}
 \section*{Тема}
Оптимизация транспортного потока при заданных пунктах отправления и назначения всех участников движения


\section{Введение}


\newpage
\section{Постановка задачи}

Пусть задан граф $G = (V, E)$, описывающий некоторую \textit{дорожную сеть}. Предположим, что имеется $n$ участников движения по этому графу. Каждый участник $i$ имеет точки отправления $A_i \in V$ и точки прибытия $B_i \in V$. Пусть множество $P_i$ - есть множество всех простых путей из $A_i$ в $B_i$. Пусть декартово произведение $P = \prod \limits_{i = 1} ^ n P_i$ есть множество всех возможных комбинаций путей участников. Элементы этого множества назовем \textit{комбинацией путей}. Пусть известно, что при комбинации путей участников $\textbf{p} \in P$ $i$-ый участник затрачивает $T_i(\textbf{p})$ времени на передвижение. Суммарные временные затраты положим $T(\textbf{p}) = \sum\limits_{i = 1}^n T_i (\textbf{p})$. Пару $(P, \{T_i\}_{i = 1} ^ n)$ назовем \textit{некооперативным передвижением} на графе $G$. Функции $T_i: P \rightarrow R_+$ назовем \textit{функцией временных затрат}.

Необходимо найти такую комбинацию путей участников $\textbf{p}^*$, что суммарные временные затраты на передвижение - минимальны
\begin{equation}
\label{eq:target_task_T} 
T (\textbf{p}^*) = \minn\limits_{ \textbf{p} \in P} T (\textbf{p})
\end{equation}
	
Комбинацию путей $\textbf{p}^*$ будем называть \textit {оптимальной}, а суммарные временные затраты  $ T (\textbf{p}^*)$ \textit {оптимальным временем передвижения участников}.

\newpage
\section{Поиск функции временных затрат}

Сложность численного решения задачи поиска оптимальной комбинации путей во многом зависит от аналитического задания функций
$T_i (\textbf{p})$. Интуитивно вполне очевидно, что на временные затраты при проезде по пути $\textbf{p}_i$ в первую очередь влияют временные затраты на ребрах, составляющих маршрут $\textbf{p}_i$. Поэтому без ограничения общности считаем, что функции временных затрат есть суммарные временные затраты на каждом ребре этого пути

$$T_i (\textbf{p}) = \sum \limits_{e \in E} \overline{\tau}_{e, i} (\textbf{p}) = \sum \limits_{e \in \textbf{p}_i} \overline{\tau}_{e, i} (\textbf{p}), $$
где функции $\overline{\tau}_{e, i} (\textbf{p})$ есть временные затраты $i$-ого участника на ребре $e$ при комбинации путей $\textbf{p}$. Поскольку подразумевается, что передвижение участников происходит непрерывно во времени, то, можно считать, что временные затраты на ребре $e$ есть затраченное участником время на этом ребре

$$  \overline{\tau}_{e, i} (\textbf{p}) = \int\limits_{0}^{\infty} \theta_{e, i} (\textbf{p}, t) dt, $$
где 

$$
\theta_{e, i} (\textbf{p}, t) =
\begin{cases}
	1, & \text{если}  \text{ i-ый участник движется по ребру $e$ в момент времени $t$}  \\
	0, & \text{иначе}
\end{cases}
$$

Для простоты записи введем функцию, отвечающую за количество машин на ребре $e$ в момент времени $t$

$$n_e(\textbf{p}, t) = \sum \limits_{i = 1}^n \theta_{e, i} (\textbf{p}, t) = \{\text{количество машин на ребре } e \text { в момент времени } t\}$$

Таким образом, суммарные временные затраты есть 

\begin{equation}
\label{eq:target_func_n_e}
T(\textbf{p}) = \sum \limits_{e \in E} \int\limits_{0}^{\infty} n_e (\textbf{p}, t) dt
\end{equation}

Поскольку передвижение каждого участника проходит непрерывно, функции $\theta_{e, i} (\textbf{p}, t)$ являются индикаторами некоторых интервалов $[t_{e, i}^{in} (\textbf{p}), t_{e, i}^{out} (\textbf{p})]$. Также $\theta_{e, i} (\textbf{p}, t)$ описывают движение по некоторому простому пути $\textbf{p}_i$, поэтому стоит ввести ограничения на $t_{e, i}^{in} (\textbf{p}), t_{e, i}^{out} (\textbf{p})$:

\begin{equation}
\label{eq:restr_t}
 \begin{cases}
	I_{e, i} (\textbf{p}) \overline{\tau}_{e, i}^{min}(\textbf{p}) \le t_{e, i}^{out}(\textbf{p}) - t_{e, i}^{in}(\textbf{p}) \le I_{e, i}(\textbf{p}) \overline{\tau}_{e, i}^{max}(\textbf{p}), e \in E, i = 1, \dots, n,
	\\
	 \sum \limits_{ \substack{E_1 = \{ e \in E: e = (X_1, B) \} \\ e \in E_1}} t_{e, i}^{out} (\textbf{p}) = \sum \limits_{ \substack{E_2 = \{ e \in E: e = (B, X_2) \} \\ e \in E_2}} t_{e, i}^{in} (\textbf{p}), B \in V, i = 1, \dots, n, E_1 \ne \emptyset, E_2 \ne \emptyset,
	\\
	I_{e, i} (\textbf{p}) \in \{0, 1\} \text { - описывают простой путь $\textbf{p}_i$ \footnotemark},
\end{cases}
\end{equation}

\footnotetext {Данное условие есть система уравнений на $I_{e, i} (\textbf{p})$, строющая биекцию между $I_{e, i}$ и \textbf{p}}

где конснтанты $\overline{\tau}_{e, i}^{min}$ и $\overline{\tau}_{e, i}^{max}$ - ограничения на функцию $\overline{\tau}_{e, i} (\textbf{p})$. Без ограничения общности считаем, что мы рассматриваем такое движение, что эти константы существуют (ограничено время проезда участника по ребру) и они положительны (нельзя пройти ребро за время $\overline{\tau}_{e, i} (\textbf{p})$ = 0).

Заметим, что система \eqref{eq:restr_t} эквивалентна задаче смешнного целочисленного линейного программирования. Однако, в такой постановке задача эквивалентна задаче поиска кратчайшего пути между вершинами $A_i$ в $B_i$ с весами $\overline{\tau}_{e, i}^{min}$. На практике машины, находящиеся вблизи друг друга влияют на скорости друг друга.

Для того, чтобы учесть влияние участников друг на друга, для каждого участника $i$ введем микроскопическую характеристику движения $v_i(\textbf{p}, t)$, описывающую скорость участника.
Тогда, имеет место

\begin{equation}
\label{eq:velocity_eq}
\int\limits_{0}^{\infty} \theta_{e, i} (\textbf{p}, t) v_i(\textbf{p}, t) dt = l_e, e \in \textbf{p}_i, i = 1, \dots, n
\end{equation}

Будем говорить, что уравнения \eqref{eq:velocity_eq} задают \textit{модель движения участников}. Таким образом задача \eqref{eq:target_task_T} эквивалентна следующей системе

\begin{equation}
\label{eq:target_task_theta_v}
\begin{cases}
	\sum \limits_{e \in E} \int\limits_{0}^{\infty} n_e (\textbf{p}, t)dt -> \minn\limits_{ \textbf{p} \in P}
	\\
	I_{e, i} (\textbf{p}) \overline{\tau}_{e, i}^{min}(\textbf{p}) \le t_{e, i}^{out}(\textbf{p}) - t_{e, i}^{in}(\textbf{p}) \le I_{e, i}(\textbf{p}) \overline{\tau}_{e, i}^{max}(\textbf{p}), e \in E, i = 1, \dots, n,
	\\
	\sum \limits_{ \substack{E_1 = \{ e \in E: e = (X_1, B) \} \\ e \in E_1}} t_{e, i}^{out} (\textbf{p}) = \sum \limits_{ \substack{E_2 = \{ e \in E: e = (B, X_2) \} \\ e \in E_2}} t_{e, i}^{in} (\textbf{p}), B \in V, i = 1, \dots, n, E_1 \ne \emptyset, E_2 \ne \emptyset,
	\\
	I_{e, i} (\textbf{p}) \in \{0, 1\} \text { - описывают простой путь $\textbf{p}_i$},
	\\
	\int\limits_{0}^{\infty} \theta_{e, i} (\textbf{p}, t) v_i(\textbf{p}, t) dt = l_e, e \in \textbf{p}_i
\end{cases}
\end{equation}

Заметим, что в случае, когда условие \eqref{eq:velocity_eq} можно описать в виде задачи смешанного целочисленного программирования, 
задача \eqref{eq:target_task_theta_v} может быть решена стандартным решателем.

\subsection*{Макроскопические модели}

Предположим скорость участника зависит только загруженности ребра, на котором он находится:

\begin{equation}
	\label{eq:velocity_eq_macro}
	 v_i(\textbf{p}, t) = \sum \limits _{e \in E} \theta_{e, i} (\textbf{p}, t) v (n_e (\textbf{p}, t)),  i = 1, \dots, n
\end{equation}

Такую модель движения в дальнейшем будем называть \textit{макроскопической}.
Например, естествено расмотреть модель $ v (n_e (\textbf{p}, t)) = \frac{v_{max}}{n_e (\textbf{p}, t)}$

\begin{lemma}
	\label{lemma:lt}
	Пусть даны переменные $a$, $b$ целочисленного программирования и известно, что существует $M > 0$ : $|a| < M$, $|b| < M$. Тогда можно добавить новую целочисленную переменную $\textbf{1} (\{a < b\}) \in \{0, 1\}$ такую, что
	
	\begin{equation*}
		\textbf{1} (\{a < b\}) = 
		\begin{cases}
			1, a < b,
			\\
			0, a \ge b
		\end{cases}
	\end{equation*}

\end{lemma}

\begin{proof}
	Добавим в нашу задачу два неравенства:
	
	$$ 2M (\textbf{1} (\{a < b\}) - 1) < b - a \le 2M\textbf{1} (\{a < b\}) $$
	
	Очевидная проверка показывает, что неравенство выполняется для любых $a, b$.
	
	
\end{proof}

\begin{state}
	Пусть модель движения $ v_i(\textbf{p}, t)$ макроскопическая. Тогда задача \eqref{eq:target_task_theta_v} есть задача смешанного целочисленного линейного программирования.
\end{state}

\begin{proof}
	Докажем для случая $n = 2$. Для случаев $n \ge 2$ доказательство аналогичное.
	
	Пусть имеется задача смешанного целочисленного линейного программирования \eqref{eq:restr_t} с переменными $t_{e, i}^{in}, t_{e, i}^{out}, I_{e, i}, e \in E, i = 1, 2$. Преобразуем условие \eqref{eq:velocity_eq} к каноническому виду. Для удобства обозначим обоих участников индексами $i, j \in \{1, 2\}$.
	
	$$\int\limits_{0}^{\infty} \theta_{e, i} (\textbf{p}, t) v_i(\textbf{p}, t)dt = \int\limits_{0}^{\infty} \theta_{e, i} (\textbf{p}, t) \sum \limits _{e^1 \in E} \theta_{e^1, i} (\textbf{p}, t) v (n_{e^1} (\textbf{p}, t)) dt = $$
	
	$$\int\limits_{0}^{\infty} \theta_{e, i} (\textbf{p}, t)  v (n_{e} (\textbf{p}, t)) dt = 
	  \int\limits_{ \substack{n_{e} (\textbf{p}, t) = 1}} \theta_{e, i} (\textbf{p}, t)  v (n_{e} (\textbf{p}, t)) dt +
	  \int\limits_{ \substack{n_{e} (\textbf{p}, t) = 2}} \theta_{e, i} (\textbf{p}, t)  v (n_{e} (\textbf{p}, t)) dt = $$
	
	$$\int\limits_{ \substack{\theta_{e, j} (\textbf{p}, t) = 0}} \theta_{e, i} (\textbf{p}, t)  v (1) dt +
	  \int\limits_{ \substack{\theta_{e, j} (\textbf{p}, t) = 1}} \theta_{e, i} (\textbf{p}, t)  v (2) dt = $$
	  
    $$\int\limits_{0}^{\infty} \theta_{e, i} (\textbf{p}, t)  v (1) dt - 
      \int\limits_{ \substack{\theta_{e, j} (\textbf{p}, t) = 1}} \theta_{e, i} (\textbf{p}, t)  v (1) dt +
	  \int\limits_{ \substack{\theta_{e, j} (\textbf{p}, t) = 1}} \theta_{e, i} (\textbf{p}, t)  v (2) dt = $$
	  
	$$v (1) \int\limits_{0}^{\infty} \theta_{e, i} (\textbf{p}, t) dt +
	  (v (2) - v(1)) \int\limits_{0}^{\infty} \theta_{e, i} (\textbf{p}, t) \theta_{e, j} (\textbf{p}, t) dt = $$
	  
    $$v (1) \overline{\tau}_{e, i} (\textbf{p}) +
    (v (2) - v(1)) \int\limits_{0}^{\infty} \theta_{e, i} (\textbf{p}, t) \theta_{e, j} (\textbf{p}, t) dt = l_e, e \in \textbf{p}_i$$
	  
	Неизвестный интеграл - время совместного проезда участников на ребре $e$.
	  
	В переменных задачи смешанного целочисленного программирования получим:
	
	$$v(1) (t_{e, i}^{out} - t_{e, i}^{in}) + (v(2) - v(1)) (t_{e, ij}^{out} - t_{e, ij}^{in}) = l_e I_{e, i},$$
	
	где новые перемнные $t_{e, ij}^{in}$, $t_{e, ij}^{out}$ отвечают за начало и конец совместного проезда участников. Просуммировав по всем ребрам $e \in E$, получим
	
	$$v(1) \sum \limits _{e \in E} (t_{e, i}^{out} - t_{e, i}^{in}) = \sum \limits _{e \in E} l_e I_{e, i} - (v(2) - v(1)) \sum \limits _{e \in E} (t_{e, ij}^{out} - t_{e, ij}^{in})$$
	
	Заметим, что часть слева есть функция оптимизации, поэтому функцию оптимизации можно переписать в виде
	$$v(1) \sum \limits _{e \in E} l_e I_{e, i} + (v(1) - v(2))  \sum \limits _{e \in E} (t_{e, ij}^{out} - t_{e, ij}^{in}) \rightarrow \minn $$
	
	Для завершения доказательства необходимо показать, что переменные $t_{e, ij}^{in}, t_{e, ij}^{out}$ описываются линейными ограничениями. Напомним, что $[t_{e, ij}^{in}, t_{e, ij}^{out}] = [t_{e, i}^{in}, t_{e, i}^{out}] \cap [t_{e, j}^{in}, t_{e, j}^{out}]$. Обозначим $\Delta t = t_{e, ij}^{out} - t_{e, ij}^{in}, \Delta t_1 =  t_{e, i}^{out} - t_{e, i}^{in}, \Delta t_2 =  t_{e, j}^{out} - t_{e, j}^{in}, \Delta t_3 =  t_{e, i}^{out} - t_{e, j}^{in}, \Delta t_4 =  t_{e, j}^{out} - t_{e, i}^{in}$
	
	Используя лемму \ref{lemma:lt}, при $M = max (\overline{\tau}_{e, i}^{max}, \overline{\tau}_{e, j}^{max})$, добавим в задачу новые переменные $\textbf{1} (\{ \Delta t_k > \Delta t_l\}), k \ne l, k, l \in {1, 2, 3, 4}$. Рассмотрим велечину $T_{max} = \sum \limits_{e \in E} max (\overline{\tau}_{e, i}^{max}, \overline{\tau}_{e, j}^{max})$. Добавим в нашу задачу следующие неравенства: 
	
	$$\Delta t \ge 0, $$
	$$\Delta t \ge \Delta t_k - T_{max} \sum \limits_{l != k} {\textbf{1} (\{ \Delta t_k > \Delta t_l\})}, k = 1, 2, 3, 4$$
	
	Тогда переменная $\Delta t$ есть длина отрезка $[t_{e, ij}^{in}, t_{e, ij}^{out}]$. 
	
\end{proof}

\begin{corollary}
	\label{corollary:rel}
	
	
	\begin{equation*}
		\textbf{1} (\{a < b\}) = 
		\begin{cases}
			1, a < b,
			\\
			0, a \ge b
		\end{cases}
	\end{equation*}
	
\end{corollary}

\begin{proof}
	Добавим в нашу задачу два неравенства:
	
	$$ 2M (\textbf{1} (\{a < b\}) - 1) < b - a \le 2M\textbf{1} (\{a < b\}) $$
	
	Очевидная проверка показывает, что неравенство выполняется для любых $a, b$.
	
	
\end{proof}

\end{document}